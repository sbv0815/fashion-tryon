<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{{ store.name }} | Probador Virtual con IA</title>
    <meta name="description" content="Pru√©bate la ropa de {{ store.name }} desde tu celular con Inteligencia Artificial. Escanea, prueba y compra.">
    <meta property="og:title" content="{{ store.name }} - Probador Virtual">
    <meta property="og:description" content="Pru√©bate la ropa desde tu celular con IA">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --bg: #08070c; --surface: #0f0e16; --card: #15141d;
            --border: rgba(255,255,255,0.06); --border-hover: rgba(255,255,255,0.12);
            --accent: {{ store.primary_color or '#c9a55a' }};
            --accent-soft: {{ store.primary_color or '#c9a55a' }}1a;
            --accent-glow: {{ store.primary_color or '#c9a55a' }}40;
            --white: #f0ece4; --text: #f0ece4; --text-mid: #8a8590; --text-dim: #4a4650;
            --green: #4ade80; --green-soft: rgba(74,222,128,0.12);
            --font-display: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-body: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            --ease: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --radius: 14px;
        }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-body); color: var(--text); background: var(--bg); overflow-x: hidden; line-height: 1.6; -webkit-font-smoothing: antialiased; }
        a { text-decoration: none; color: inherit; transition: all 0.3s var(--ease); }

        /* ===== HEADER ===== */
        .store-header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(8,7,12,0.92); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border-bottom: 1px solid var(--border);
            padding: 14px 0;
        }
        .header-inner {
            max-width: 1000px; margin: 0 auto; padding: 0 20px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .header-brand {
            display: flex; align-items: center; gap: 12px;
        }
        .header-logo {
            width: 36px; height: 36px; border-radius: 10px; object-fit: cover;
            border: 1px solid var(--border);
        }
        .header-name {
            font-family: var(--font-display); font-size: 1.1rem; font-weight: 700;
            color: var(--white); letter-spacing: -0.3px;
        }
        .header-badge {
            display: inline-flex; align-items: center; gap: 5px;
            background: var(--accent-soft); color: var(--accent);
            padding: 3px 10px; border-radius: 20px; font-size: 0.65rem;
            font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase;
            margin-left: 8px;
        }
        .header-actions { display: flex; align-items: center; gap: 10px; }
        .header-link {
            padding: 8px 16px; border-radius: 10px; font-size: 0.8rem; font-weight: 600;
            color: var(--text-mid); border: 1px solid var(--border); transition: all 0.3s;
        }
        .header-link:hover { border-color: var(--accent); color: var(--accent); }
        .btn-tryon-header {
            padding: 8px 18px; border-radius: 10px; font-size: 0.8rem; font-weight: 700;
            background: var(--accent); color: var(--bg); border: none; cursor: pointer;
            font-family: var(--font-body); transition: all 0.3s;
        }
        .btn-tryon-header:hover { filter: brightness(1.15); transform: translateY(-1px); box-shadow: 0 6px 20px var(--accent-glow); }

        /* ===== HERO BANNER ===== */
        .store-hero {
            background: var(--surface); border-bottom: 1px solid var(--border);
            padding: 48px 20px 40px; text-align: center;
        }
        .hero-inner { max-width: 600px; margin: 0 auto; }
        .hero-store-name {
            font-family: var(--font-display); font-size: clamp(1.8rem, 4vw, 2.4rem);
            font-weight: 800; color: var(--white); letter-spacing: -1px; margin-bottom: 8px;
        }
        .hero-tagline { color: var(--text-mid); font-size: 1rem; margin-bottom: 20px; font-weight: 300; }
        .hero-meta { display: flex; justify-content: center; gap: 24px; flex-wrap: wrap; }
        .hero-meta-item {
            display: flex; align-items: center; gap: 6px;
            font-size: 0.8rem; color: var(--text-dim);
        }
        .hero-meta-item .dot { width: 5px; height: 5px; border-radius: 50%; background: var(--accent); }

        /* ===== FILTERS ===== */
        .filters-bar {
            max-width: 1000px; margin: 0 auto;
            padding: 20px 20px 0;
            display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;
        }
        .filters-left { display: flex; gap: 6px; flex-wrap: wrap; }
        .filter-chip {
            padding: 8px 16px; border-radius: 50px; font-size: 0.8rem; font-weight: 500;
            background: transparent; border: 1px solid var(--border); color: var(--text-mid);
            cursor: pointer; font-family: var(--font-body); transition: all 0.25s;
        }
        .filter-chip:hover { border-color: var(--accent); color: var(--white); }
        .filter-chip.active { background: var(--accent); color: var(--bg); border-color: var(--accent); font-weight: 700; }
        .garment-count { font-size: 0.8rem; color: var(--text-dim); }

        /* ===== GARMENT GRID ===== */
        .catalog-section { max-width: 1000px; margin: 0 auto; padding: 20px; }

        .garment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }
        @media (max-width: 520px) {
            .garment-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        }

        .garment-card {
            background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
            overflow: hidden; transition: all 0.35s var(--ease); position: relative; cursor: pointer;
        }
        .garment-card:hover {
            border-color: var(--border-hover); transform: translateY(-4px);
            box-shadow: 0 16px 40px rgba(0,0,0,0.3);
        }
        .garment-card .img-wrap {
            position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #111;
        }
        .garment-card img {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.5s var(--ease);
        }
        .garment-card:hover img { transform: scale(1.05); }

        .garment-card .tryon-badge {
            position: absolute; top: 10px; left: 10px;
            background: var(--accent); color: var(--bg); padding: 4px 10px; border-radius: 8px;
            font-size: 0.65rem; font-weight: 700; letter-spacing: 0.3px;
            box-shadow: 0 4px 12px var(--accent-glow);
        }
        .garment-card .view-badge {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.7); color: var(--text-mid); padding: 4px 10px; border-radius: 8px;
            font-size: 0.65rem; font-weight: 500;
        }
        .garment-card .cat-icon {
            position: absolute; top: 10px; right: 10px;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
            padding: 5px 8px; border-radius: 8px; font-size: 0.9rem;
        }

        .garment-info { padding: 12px 14px 14px; }
        .garment-name { font-family: var(--font-display); font-weight: 600; font-size: 0.9rem; color: var(--white); margin-bottom: 4px; }
        .garment-meta { font-size: 0.75rem; color: var(--text-mid); margin-bottom: 6px; }
        .garment-bottom { display: flex; align-items: center; justify-content: space-between; }
        .garment-price { font-family: var(--font-display); font-weight: 700; font-size: 0.95rem; color: var(--accent); }
        .garment-size {
            background: var(--surface); padding: 3px 10px; border-radius: 6px;
            font-size: 0.7rem; font-weight: 600; color: var(--text-mid); border: 1px solid var(--border);
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center; padding: 60px 20px;
        }
        .empty-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.3; }
        .empty-title { font-family: var(--font-display); font-size: 1.2rem; color: var(--white); margin-bottom: 8px; }
        .empty-text { color: var(--text-mid); font-size: 0.9rem; }

        /* ===== CTA FLOATING ===== */
        .cta-float {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 90; display: none;
        }
        .cta-float.visible { display: block; animation: slideUp 0.4s var(--ease); }
        @keyframes slideUp { from { opacity:0; transform: translateX(-50%) translateY(20px); } to { opacity:1; transform: translateX(-50%) translateY(0); } }
        .cta-float-btn {
            display: flex; align-items: center; gap: 8px;
            padding: 14px 28px; background: var(--accent); color: var(--bg);
            border-radius: 50px; font-family: var(--font-body); font-size: 0.9rem; font-weight: 700;
            border: none; cursor: pointer; box-shadow: 0 8px 30px var(--accent-glow), 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        .cta-float-btn:hover { filter: brightness(1.12); transform: scale(1.03); }

        /* ===== HOW IT WORKS MINI ===== */
        .how-mini {
            max-width: 1000px; margin: 0 auto;
            padding: 40px 20px 20px;
        }
        .how-mini-title {
            font-family: var(--font-display); font-size: 0.75rem; color: var(--accent);
            text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px; font-weight: 700;
            display: flex; align-items: center; gap: 10px;
        }
        .how-mini-title::before { content: ''; width: 20px; height: 1.5px; background: var(--accent); }
        .how-steps {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
        }
        @media (max-width: 520px) { .how-steps { grid-template-columns: 1fr; } }
        .how-step {
            background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
            padding: 16px 18px; display: flex; align-items: flex-start; gap: 12px;
        }
        .how-step-num {
            width: 28px; height: 28px; border-radius: 8px;
            background: var(--accent-soft); color: var(--accent);
            display: flex; align-items: center; justify-content: center;
            font-family: var(--font-display); font-size: 0.75rem; font-weight: 800; flex-shrink: 0;
        }
        .how-step-text { font-size: 0.8rem; color: var(--text-mid); line-height: 1.5; }
        .how-step-text strong { color: var(--white); font-weight: 600; }

        /* ===== FOOTER ===== */
        .store-footer {
            max-width: 1000px; margin: 0 auto;
            padding: 40px 20px; text-align: center;
            border-top: 1px solid var(--border); margin-top: 40px;
        }
        .footer-powered {
            font-size: 0.75rem; color: var(--text-dim);
        }
        .footer-powered a { color: var(--accent); font-weight: 600; }
        .footer-links { display: flex; justify-content: center; gap: 20px; margin-top: 12px; }
        .footer-links a { font-size: 0.8rem; color: var(--text-mid); }
        .footer-links a:hover { color: var(--accent); }

        /* ===== ANIMATIONS ===== */
        .fade-up { opacity: 0; transform: translateY(16px); transition: all 0.5s var(--ease); }
        .fade-up.visible { opacity: 1; transform: translateY(0); }

        /* ===== LOADING ===== */
        .loading-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px;
        }
        .skeleton {
            background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
            overflow: hidden;
        }
        .skeleton .skel-img { width: 100%; aspect-ratio: 3/4; background: linear-gradient(110deg, #15141d 30%, #1d1c25 50%, #15141d 70%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        .skeleton .skel-info { padding: 12px 14px; }
        .skeleton .skel-line { height: 12px; background: #1d1c25; border-radius: 4px; margin-bottom: 8px; }
        .skeleton .skel-line.w60 { width: 60%; }
        .skeleton .skel-line.w40 { width: 40%; }
        @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="store-header">
        <div class="header-inner">
            <div class="header-brand">
                {% if store.logo_url %}
                    <img src="{{ store.logo_url }}" alt="{{ store.name }}" class="header-logo">
                {% endif %}
                <span class="header-name">{{ store.name }}</span>
                <span class="header-badge">‚ú® Probador IA</span>
            </div>
            <div class="header-actions">
                <a href="/muro/{{ store.slug }}" class="header-link">üñºÔ∏è Muro</a>
                {% if store.instagram %}
                    <a href="https://instagram.com/{{ store.instagram }}" target="_blank" class="header-link">@{{ store.instagram }}</a>
                {% endif %}
                <button class="btn-tryon-header" onclick="goTryOn()">Probarme ropa</button>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <section class="store-hero">
        <div class="hero-inner">
            <h1 class="hero-store-name">{{ store.name }}</h1>
            <p class="hero-tagline">Pru√©bate nuestra ropa desde tu celular con Inteligencia Artificial</p>
            <div class="hero-meta">
                <div class="hero-meta-item"><span class="dot"></span> <span id="totalGarments">‚Äî</span> prendas</div>
                {% if store.address %}
                    <div class="hero-meta-item"><span class="dot"></span> {{ store.address }}</div>
                {% endif %}
                {% if store.phone %}
                    <div class="hero-meta-item"><span class="dot"></span> <a href="https://wa.me/{{ store.phone }}" style="color:var(--text-dim);">WhatsApp</a></div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- HOW IT WORKS -->
    <section class="how-mini fade-up">
        <div class="how-mini-title">C√≥mo funciona</div>
        <div class="how-steps">
            <div class="how-step">
                <div class="how-step-num">1</div>
                <div class="how-step-text"><strong>Escoge prendas</strong> ‚Äî Selecciona las que tengan la etiqueta ‚ú® Probador IA</div>
            </div>
            <div class="how-step">
                <div class="how-step-num">2</div>
                <div class="how-step-text"><strong>Toma una foto</strong> ‚Äî Foto de cuerpo completo, de frente y con buena luz</div>
            </div>
            <div class="how-step">
                <div class="how-step-num">3</div>
                <div class="how-step-text"><strong>Ve el resultado</strong> ‚Äî La IA te muestra c√≥mo te queda en segundos</div>
            </div>
        </div>
    </section>

    <!-- FILTERS -->
    <div class="filters-bar fade-up">
        <div class="filters-left">
            <button class="filter-chip active" onclick="filterCat('all', this)">Todas</button>
            <button class="filter-chip" onclick="filterCat('tops', this)">üëï Tops</button>
            <button class="filter-chip" onclick="filterCat('bottoms', this)">üëñ Bottoms</button>
            <button class="filter-chip" onclick="filterCat('one-pieces', this)">üëó Vestidos</button>
        </div>
        <div class="garment-count"><span id="filteredCount">‚Äî</span> prendas</div>
    </div>

    <!-- CATALOG -->
    <section class="catalog-section">
        <!-- Loading skeletons -->
        <div class="loading-grid" id="loadingSkeleton">
            <div class="skeleton"><div class="skel-img"></div><div class="skel-info"><div class="skel-line"></div><div class="skel-line w60"></div><div class="skel-line w40"></div></div></div>
            <div class="skeleton"><div class="skel-img"></div><div class="skel-info"><div class="skel-line"></div><div class="skel-line w60"></div><div class="skel-line w40"></div></div></div>
            <div class="skeleton"><div class="skel-img"></div><div class="skel-info"><div class="skel-line"></div><div class="skel-line w60"></div><div class="skel-line w40"></div></div></div>
            <div class="skeleton"><div class="skel-img"></div><div class="skel-info"><div class="skel-line"></div><div class="skel-line w60"></div><div class="skel-line w40"></div></div></div>
        </div>

        <!-- Actual grid -->
        <div class="garment-grid" id="garmentGrid" style="display:none;"></div>

        <!-- Empty state -->
        <div class="empty-state" id="emptyState" style="display:none;">
            <div class="empty-icon">üëó</div>
            <div class="empty-title">Pr√≥ximamente</div>
            <div class="empty-text">Estamos preparando el cat√°logo. ¬°Vuelve pronto!</div>
        </div>
    </section>

    <!-- FLOATING CTA -->
    <div class="cta-float" id="ctaFloat">
        <button class="cta-float-btn" onclick="goTryOn()">
            ‚ú® Probarme ropa con IA
        </button>
    </div>

    <!-- FOOTER -->
    <footer class="store-footer">
        <div class="footer-powered">
            Probador virtual con IA por <a href="/" target="_blank">Fashion TryOn</a> ¬∑ TSCAMP SAS
        </div>
        <div class="footer-links">
            {% if store.instagram %}<a href="https://instagram.com/{{ store.instagram }}" target="_blank">Instagram</a>{% endif %}
            {% if store.website %}<a href="{{ store.website }}" target="_blank">Sitio web</a>{% endif %}
            {% if store.phone %}<a href="https://wa.me/{{ store.phone }}">WhatsApp</a>{% endif %}
        </div>
    </footer>

<script>
const STORE_ID = '{{ store.id }}';
const STORE_SLUG = '{{ store.slug }}';
let catalog = [];
let currentFilter = 'all';

// ============================================================
// LOAD CATALOG
// ============================================================
async function loadCatalog() {
    try {
        const resp = await fetch(`/api/catalog/${STORE_ID}`);
        const data = await resp.json();
        catalog = data.garments || [];

        document.getElementById('totalGarments').textContent = catalog.length;
        document.getElementById('loadingSkeleton').style.display = 'none';

        if (catalog.length === 0) {
            document.getElementById('emptyState').style.display = 'block';
            return;
        }

        document.getElementById('garmentGrid').style.display = 'grid';
        renderGarments();

        // Show floating CTA after scroll
        setTimeout(() => {
            const hasTryon = catalog.some(g => g.tryon_enabled);
            if (hasTryon) document.getElementById('ctaFloat').classList.add('visible');
        }, 2000);

    } catch(e) {
        console.error(e);
        document.getElementById('loadingSkeleton').style.display = 'none';
        document.getElementById('emptyState').style.display = 'block';
    }
}

function renderGarments() {
    const filtered = currentFilter === 'all' ? catalog : catalog.filter(g => g.category === currentFilter);
    document.getElementById('filteredCount').textContent = filtered.length;

    // Sort: tryon_enabled first
    const sorted = [...filtered].sort((a, b) => {
        if (a.tryon_enabled && !b.tryon_enabled) return -1;
        if (!a.tryon_enabled && b.tryon_enabled) return 1;
        return 0;
    });

    const grid = document.getElementById('garmentGrid');
    if (sorted.length === 0) {
        grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text-mid);">No hay prendas en esta categor√≠a</div>`;
        return;
    }

    grid.innerHTML = sorted.map(g => {
        const catIcon = g.category === 'tops' ? 'üëï' : g.category === 'bottoms' ? 'üëñ' : 'üëó';
        const canTry = g.tryon_enabled;
        return `
        <div class="garment-card fade-up" onclick="${canTry ? `goTryOnGarment('${g.id}')` : `viewGarment('${g.id}')`}">
            <div class="img-wrap">
                <img src="${g.image_url}" alt="${g.name}" loading="lazy">
                ${canTry
                    ? '<div class="tryon-badge">‚ú® Probador IA</div>'
                    : '<div class="view-badge">Solo exhibici√≥n</div>'}
                <div class="cat-icon">${catIcon}</div>
            </div>
            <div class="garment-info">
                <div class="garment-name">${g.name}</div>
                <div class="garment-meta">${g.reference ? 'Ref: ' + g.reference + ' ¬∑ ' : ''}${g.color || g.category}</div>
                <div class="garment-bottom">
                    ${g.price ? `<div class="garment-price">$${Number(g.price).toLocaleString('es-CO')}</div>` : '<div></div>'}
                    <div class="garment-size">${g.size}</div>
                </div>
            </div>
        </div>`;
    }).join('');

    // Animate in
    requestAnimationFrame(() => {
        grid.querySelectorAll('.fade-up').forEach((el, i) => {
            setTimeout(() => el.classList.add('visible'), i * 60);
        });
    });
}

// ============================================================
// FILTERS
// ============================================================
function filterCat(cat, el) {
    currentFilter = cat;
    document.querySelectorAll('.filter-chip').forEach(b => b.classList.remove('active'));
    if (el) el.classList.add('active');
    renderGarments();
}

// ============================================================
// NAVIGATION
// ============================================================
function goTryOn() {
    window.location.href = `/tienda?store=${STORE_ID}`;
}

function goTryOnGarment(garmentId) {
    window.location.href = `/prenda/${garmentId}`;
}

function viewGarment(garmentId) {
    window.location.href = `/prenda/${garmentId}`;
}

// ============================================================
// SCROLL ANIMATIONS
// ============================================================
const obs = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold: 0.1 });
document.querySelectorAll('.fade-up').forEach(el => obs.observe(el));

// Show/hide floating CTA based on scroll
let lastScroll = 0;
window.addEventListener('scroll', () => {
    const cta = document.getElementById('ctaFloat');
    if (window.scrollY > 400) {
        cta.classList.add('visible');
    }
    if (window.scrollY > lastScroll + 50 && window.scrollY > 600) {
        cta.style.opacity = '0';
        cta.style.pointerEvents = 'none';
    } else {
        cta.style.opacity = '1';
        cta.style.pointerEvents = 'auto';
    }
    lastScroll = window.scrollY;
});

// ============================================================
// INIT
// ============================================================
loadCatalog();
</script>
</body>
</html>
